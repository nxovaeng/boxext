{"config":{"lang":["zh"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"TVBox \u8d44\u6e90\u914d\u7f6e","text":"<p>\u6b22\u8fce\u4f7f\u7528 TVBox \u8d44\u6e90\u914d\u7f6e\u7ba1\u7406\u5de5\u5177\uff01</p>"},{"location":"#_1","title":"\ud83d\ude80 \u5feb\u901f\u5f00\u59cb","text":""},{"location":"#_2","title":"\u8ba2\u9605\u5730\u5740","text":"<p>----------\u7eafAPI\u7ad9\u70b9------------ <pre><code>https://box.zro.qzz.io/tvbox.json\n</code></pre></p> <p>==========\u805a\u5408\u7ad9\u70b9============ <pre><code>https://box.zro.qzz.io/tvbox.json\n</code></pre></p>"},{"location":"#_3","title":"\u529f\u80fd\u7279\u70b9","text":"<ul> <li>\u2705 \u667a\u80fd\u7b5b\u9009 - \u81ea\u52a8\u8fc7\u6ee4\u4f4e\u8d28\u91cf\u7ad9\u70b9</li> <li>\u2705 \u5b9a\u65f6\u66f4\u65b0 - \u6bcf\u5468\u81ea\u52a8\u6784\u5efa\u53d1\u5e03</li> <li>\u2705 \u591a\u6e90\u805a\u5408 - \u6574\u5408\u591a\u4e2a\u4f18\u8d28\u914d\u7f6e\u6e90</li> <li>\u2705 \u81ea\u5b9a\u4e49\u63d2\u4ef6 - \u652f\u6301\u8c46\u74e3\u70ed\u641c\u7b49\u6269\u5c55</li> </ul>"},{"location":"#_4","title":"\ud83d\udcd6 \u6587\u6863\u5bfc\u822a","text":"\u6587\u6863 \u8bf4\u660e \u4f7f\u7528\u624b\u518c \u9879\u76ee\u4f7f\u7528\u8bf4\u660e DRPY\u4ee3\u7406\u6307\u5357 DRPY \u4ee3\u7406\u914d\u7f6e \u914d\u7f6e\u5206\u6790 TVBox \u914d\u7f6e\u7ed3\u6784\u5206\u6790"},{"location":"#_5","title":"\ud83d\udcc1 \u8d44\u6e90\u6587\u4ef6","text":"\u6587\u4ef6 \u8bf4\u660e <code>tvbox.json</code> \u4e3b\u914d\u7f6e\u6587\u4ef6 <code>js/douban_hot_v2.js</code> \u8c46\u74e3\u70ed\u641c\u63d2\u4ef6"},{"location":"#_6","title":"\ud83d\udd27 \u672c\u5730\u5f00\u53d1","text":"<pre><code># \u5b89\u88c5\u4f9d\u8d56\npip install -r requirements.txt\n\n# \u9a8c\u8bc1\u914d\u7f6e\npython unified_manager.py validate\n\n# \u6784\u5efa\u53d1\u5e03\npython unified_manager.py build --output smart_output\n</code></pre>"},{"location":"#_7","title":"\ud83d\udcdd \u66f4\u65b0\u65e5\u5fd7","text":"<p>\u67e5\u770b GitHub Releases \u83b7\u53d6\u6700\u65b0\u66f4\u65b0\u3002</p>"},{"location":"DRPY_PROXY_GUIDE/","title":"DrPy Local Proxy Deployment Guide","text":""},{"location":"DRPY_PROXY_GUIDE/#1-1270019978","title":"1. \u4ec0\u4e48\u662f <code>127.0.0.1:9978</code>?","text":"<p>\u5728 <code>drpy_js</code> \u63d2\u4ef6\u4e2d\uff0c\u60a8\u7ecf\u5e38\u4f1a\u770b\u5230 <code>127.0.0.1:9978</code>\u3002\u8fd9\u662f\u4e00\u4e2a\u672c\u5730\u4ee3\u7406\u670d\u52a1 (CMS Proxy)\u3002 *   \u4f5c\u7528: \u5b83\u8d1f\u8d23\u5904\u7406\u590d\u6742\u7684\u52a0\u5bc6\u89e3\u5bc6\u3001HTML \u89e3\u6790 (PyQuery/XPath) \u548c\u8de8\u57df\u8bf7\u6c42\u53cd\u5411\u4ee3\u7406\uff0c\u5f25\u8865\u4e86\u7eaf JS \u73af\u5883\u80fd\u529b\u7684\u4e0d\u8db3\u3002 *   \u6765\u6e90: \u5728 TVBox APP \u8fd0\u884c\u65f6\uff0cAPP \u5185\u90e8\u4f1a\u542f\u52a8\u8fd9\u4e2a\u670d\u52a1\u3002\u4f46\u5728 PC \u7aef\u9a8c\u8bc1\u6216\u4f7f\u7528\u79bb\u7ebf\u5305\u65f6\uff0c\u60a8\u9700\u8981\u624b\u52a8\u8fd0\u884c\u8fd9\u4e2a\u670d\u52a1\u3002</p>"},{"location":"DRPY_PROXY_GUIDE/#2","title":"2. \u5982\u4f55\u90e8\u7f72\u670d\u52a1?","text":""},{"location":"DRPY_PROXY_GUIDE/#a-python-hipy-server","title":"\u65b9\u6848 A: \u4f7f\u7528 Python (\u7c7b\u4f3c\u4e8e <code>hipy-server</code>)","text":"<p>\u8fd9\u662f\u6700\u901a\u7528\u7684\u65b9\u6cd5\uff0c\u6a21\u62df TVBox \u7684 Python \u540e\u7aef\u3002</p> <ol> <li> <p>\u51c6\u5907\u73af\u5883:</p> <ul> <li>\u5b89\u88c5 Python 3.8+</li> <li>\u5b89\u88c5\u4f9d\u8d56: <code>pip install flask requests lxm gunicorn</code></li> </ul> </li> <li> <p>\u521b\u5efa\u670d\u52a1\u5668\u811a\u672c <code>proxy_server.py</code>:     <pre><code>from flask import Flask, request, Response\nimport requests\n\napp = Flask(__name__)\n\n@app.route('/proxy')\ndef proxy():\n    url = request.args.get('url')\n    if not url: return \"Missing URL\", 400\n    # \u7b80\u5355\u8f6c\u53d1 (\u751f\u4ea7\u73af\u5883\u9700\u5b8c\u5584 Header\u5904\u7406)\n    try:\n        resp = requests.get(url, headers={'User-Agent': 'Mozilla/5.0'})\n        return Response(resp.content, resp.status_code, dict(resp.headers))\n    except Exception as e:\n        return str(e), 500\n\n@app.route('/cms')\ndef cms():\n    # \u8fd9\u91cc\u9700\u8981\u5b9e\u73b0 CMS \u63a5\u53e3\u903b\u8f91 (\u901a\u5e38\u6bd4\u8f83\u590d\u6742\uff0c\u5efa\u8bae\u4f7f\u7528\u73b0\u6210\u9879\u76ee)\n    return \"CMS Mock\"\n\nif __name__ == '__main__':\n    app.run(host='127.0.0.1', port=9978)\n</code></pre></p> </li> <li> <p>\u8fd0\u884c: <code>python proxy_server.py</code></p> </li> </ol>"},{"location":"DRPY_PROXY_GUIDE/#b-docker","title":"\u65b9\u6848 B: \u4f7f\u7528 Docker (\u63a8\u8350)","text":"<p>\u793e\u533a\u6709\u6210\u719f\u7684 Docker \u955c\u50cf (\u5982 <code>als-server</code> \u6216 <code>hipy-server</code>)\u3002</p> <p><pre><code>docker run -d -p 9978:9978 --name tvbox-proxy link/to/image\n</code></pre> (\u6ce8: \u8bf7\u5728 Docker Hub \u641c\u7d22 \"tvbox proxy\" \u6216 \"hipy\" \u83b7\u53d6\u6700\u65b0\u955c\u50cf)</p>"},{"location":"DRPY_PROXY_GUIDE/#c","title":"\u65b9\u6848 C: \u4ec5\u9a8c\u8bc1 (\u5ffd\u7565)","text":"<p>\u5982\u679c\u60a8\u53ea\u662f\u9a8c\u8bc1\u914d\u7f6e\u683c\u5f0f\uff0c\u800c\u4e0d\u662f\u771f\u7684\u8981\u64ad\u653e\u89c6\u9891\uff0c\u53ef\u4ee5\u5728 <code>SmartValidator</code> \u4e2d\u5ffd\u7565\u6b64\u5730\u5740 (\u6211\u4eec\u5df2\u901a\u8fc7\u4ee3\u7801\u66f4\u65b0\u5b9e\u73b0\u4e86\u8fd9\u4e00\u70b9\uff0c\u62a5\u544a\u4e2d\u4e0d\u518d\u62a5\u9519)\u3002</p>"},{"location":"DRPY_PROXY_GUIDE/#3","title":"3. \u5728\u914d\u7f6e\u4e2d\u4f7f\u7528","text":"<p>\u5982\u679c\u60a8\u7684\u670d\u52a1\u90e8\u7f72\u5728\u516c\u7f51 IP \u6216\u5c40\u57df\u7f51\u5176\u4ed6\u673a\u5668 (\u5982 NAS)\uff0c\u8bf7\u4fee\u6539 JS \u63d2\u4ef6\u4e2d\u7684\u5730\u5740\uff1a *   \u539f\u4ee3\u7801: <code>return \"http://127.0.0.1:9978/proxy?do=js\"</code> *   \u4fee\u6539\u540e: <code>return \"http://192.168.1.100:9978/proxy?do=js\"</code></p>"},{"location":"DRPY_PROXY_GUIDE/#4","title":"4. \u5e38\u89c1\u9879\u76ee\u53c2\u8003","text":"<p>\u8981\u83b7\u5f97\u5b8c\u6574\u7684 9978 \u670d\u52a1\u80fd\u529b (\u5305\u542b OCR\u3001\u52a0\u5bc6)\uff0c\u5efa\u8bae\u53c2\u8003\u4ee5\u4e0b\u5f00\u6e90\u9879\u76ee\uff1a *   HiPy-Server (Python) *   CatVodOpen (Java/Android)</p>"},{"location":"DRPY_PROXY_GUIDE/#5-tvbox-app-faq","title":"5. TVBox APP \u8fd0\u884c\u673a\u5236 (FAQ)","text":"<p>Q: \u5728 TVBox APP (\u5b89\u5353\u7aef) \u8fd0\u884c\u65f6\uff0c\u6211\u9700\u8981\u624b\u52a8\u5f00\u542f\u8fd9\u4e2a\u670d\u52a1\u5417\uff1f</p> <p>A: \u4e0d\u9700\u8981\u3002  TVBox APP \u5185\u90e8\u96c6\u6210\u4e86 <code>drpy</code> \u7684 Python \u73af\u5883\uff08\u6216 Java \u6a21\u62df\u5c42\uff09\u3002 1.  \u81ea\u52a8\u542f\u52a8: \u5f53 APP \u542f\u52a8\u65f6\uff0c\u5b83\u4f1a\u81ea\u52a8\u5728\u540e\u53f0\u8fd0\u884c\u4e00\u4e2a\u672c\u5730\u4ee3\u7406\u670d\u52a1 (\u901a\u5e38\u76d1\u542c 9978 \u7aef\u53e3)\u3002 2.  \u81ea\u52a8\u914d\u7f6e: \u60a8\u7684\u914d\u7f6e\u6587\u4ef6\u4e2d\u53ea\u8981\u5199 <code>http://127.0.0.1:9978/...</code>\uff0cAPP \u5185\u90e8\u7684 WebView \u5c31\u80fd\u81ea\u52a8\u8bf7\u6c42\u5230\u8fd9\u4e2a\u5185\u7f6e\u670d\u52a1\u3002 3.  \u5f00\u53d1\u6ce8\u610f: \u672c\u6587\u6863\u4ecb\u7ecd\u7684 \"\u90e8\u7f72\u6307\u5357\" \u4e3b\u8981\u662f\u4e3a\u4e86\u8ba9\u60a8\u5728 \u7535\u8111 (PC/Mac/Linux) \u4e0a\u6d4b\u8bd5\u63d2\u4ef6\uff0c\u6216\u8005\u5728 NAS/\u670d\u52a1\u5668 \u4e0a\u96c6\u4e2d\u90e8\u7f72\u65f6\u4f7f\u7528\u3002</p>"},{"location":"MANUAL/","title":"TVBox \u914d\u7f6e\u7ba1\u7406\u7cfb\u7edf - \u7528\u6237\u624b\u518c (2026 \u7248)","text":""},{"location":"MANUAL/#1","title":"1. \u7b80\u4ecb","text":"<p>\u672c\u9879\u76ee\u662f\u57fa\u4e8e 2026 \u5e74\u6700\u4f73\u5b9e\u8df5 \u6784\u5efa\u7684 TVBox \u914d\u7f6e\u7ba1\u7406\u7cfb\u7edf\u3002\u6211\u4eec\u4e3a\u60a8\u63d0\u4f9b\u4e86\u4e00\u5957\u5b8c\u6574\u7684\u5de5\u5177\u94fe\uff0c\u7528\u4e8e\u9a8c\u8bc1\u3001\u6784\u5efa\u548c\u4f18\u5316\u60a8\u7684 TVBox \u914d\u7f6e\u6587\u4ef6 (json, js, py)\u3002</p> <p>\u6838\u5fc3\u7406\u5ff5: *   \u7edf\u4e00: \u4e00\u4e2a\u811a\u672c (<code>unified_manager.py</code>) \u641e\u5b9a\u9a8c\u8bc1\u3001\u4e0b\u8f7d\u3001\u6e05\u7406\u3001\u6784\u5efa\u3002 *   \u5b89\u5168: \u672c\u5730\u4e0b\u8f7d\u5e76\u6821\u9a8c\u8d44\u6e90\u5b8c\u6574\u6027\uff0c\u63d0\u4f9b\u5b89\u5168\u626b\u63cf\u529f\u80fd\u3002 *   \u667a\u80fd: \u81ea\u52a8\u5206\u6790\u63d2\u4ef6\u4f9d\u8d56\uff0c\u53bb\u4f2a\u5b58\u771f\u3002 *   \u7a33\u5b9a: \u81ea\u52a8\u751f\u6210\u672c\u5730\u53d1\u5e03\u76ee\u5f55\uff0c\u6e90\u7ad9\u5931\u6548\u4e5f\u4e0d\u4f1a\u5bfc\u81f4\u60a8\u7684\u914d\u7f6e\u4e0d\u53ef\u7528\u3002</p>"},{"location":"MANUAL/#2","title":"2. \u5feb\u901f\u5165\u95e8","text":""},{"location":"MANUAL/#21","title":"2.1 \u57fa\u7840\u9a8c\u8bc1","text":"<p>\u9a8c\u8bc1\u60a8\u7684\u914d\u7f6e\u6587\u4ef6\u662f\u5426\u6709\u6548\u3002</p> <pre><code># \u8bfb\u53d6 config.json \u4e2d\u7684\u6240\u6709\u6e90\u5e76\u9a8c\u8bc1\npython3 unified_manager.py validate\n\n# \u4ec5\u9a8c\u8bc1\u6307\u5b9a\u7684 URL\npython3 unified_manager.py validate --url https://raw.githubusercontent.com/user/tvbox/main/config.json\n</code></pre>"},{"location":"MANUAL/#22-build-publish","title":"2.2 \u6784\u5efa\u5e76\u53d1\u5e03 (Build &amp; Publish)","text":"<p>\u6b64\u547d\u4ee4\u4f1a\u81ea\u52a8\u5b8c\u6210\u4ee5\u4e0b\u6b65\u9aa4\uff1a 1.  \u9a8c\u8bc1\u6240\u6709\u542f\u7528\u7684\u6e90\u3002 2.  \u4e0b\u8f7d\u6240\u6709 <code>site.api</code>, <code>spider.jar</code>, <code>ext</code> \u4e2d\u7684 JS/Python \u6587\u4ef6\u3002 3.  \u81ea\u52a8\u5206\u6790 JS/Python \u63d2\u4ef6\u4e2d\u5f15\u7528\u7684\u9690\u5f0f\u4f9d\u8d56\u5e76\u5c1d\u8bd5\u9884\u4e0b\u8f7d\u3002 4.  \u751f\u6210\u53bb\u91cd\u7684\u3001\u53ef\u90e8\u7f72\u7684\u914d\u7f6e\u6587\u4ef6\u3002</p> <pre><code>python3 unified_manager.py build\n</code></pre> <p>\u8f93\u51fa\u76ee\u5f55: <code>smart_output/merged/</code></p> <p>\u5982\u4f55\u4f7f\u7528: 1.  \u5c06 <code>smart_output/merged/</code> \u76ee\u5f55\u4e0a\u4f20\u5230\u60a8\u7684 Web \u670d\u52a1\u5668\u3001CDN \u6216 GitHub Pages\u3002 2.  \u5728 TVBox \u4e2d\u8f93\u5165\u8be5\u5730\u5740\u5373\u53ef\u4f7f\u7528\u3002</p> <p>\u672c\u5730\u6d4b\u8bd5: <pre><code>cd smart_output/merged\npython3 -m http.server 8000\n# \u8bbf\u95ee http://localhost:8000/config.json\n</code></pre></p>"},{"location":"MANUAL/#23-premium","title":"2.3 \u751f\u6210\u9ad8\u7ea7\u914d\u7f6e (Premium)","text":"<p>\u81ea\u52a8\u751f\u6210\u9488\u5bf9 \u53bb\u5e7f\u544a\u3001DNS \u4f18\u5316 \u548c \u9ad8\u8d28\u91cf\u6e90\u7b5b\u9009 \u7684\u7279\u5236\u914d\u7f6e\u3002</p> <pre><code>python3 unified_manager.py premium\n</code></pre> <p>\u6ce8\u610f: \u9700\u8981\u60a8\u7684\u7cfb\u7edf\u73af\u5883\u652f\u6301\u76f8\u5173Python\u5e93 (requests, beautifulsoup4 \u7b49)\u3002</p>"},{"location":"MANUAL/#3","title":"3. \u914d\u7f6e\u6307\u5357","text":""},{"location":"MANUAL/#31-configjson","title":"3.1 <code>config.json</code> \u683c\u5f0f","text":"<p>\u8fd9\u662f\u60a8\u7ba1\u7406\u6e90\u7684\u552f\u4e00\u5165\u53e3\u3002</p> <pre><code>{\n  \"sources\": [\n    {\n      \"name\": \"\u793a\u4f8b\u6e901\",\n      \"url\": \"https://example.com/api/config.json\",\n      \"enabled\": true\n    },\n    {\n      \"name\": \"\u672c\u5730\u6e90\",\n      \"url\": \"file:///path/to/local.json\",\n      \"enabled\": false\n    }\n  ],\n  \"validation\": {\n    \"timeout\": 15,\n    \"max_workers\": 10\n  }\n}\n</code></pre>"},{"location":"MANUAL/#32-premium-features","title":"3.2 \u9ad8\u7ea7\u529f\u80fd (Premium Features)","text":"<p>\u5728 <code>python3 unified_manager.py premium</code> \u547d\u4ee4\u4e2d\uff0c\u7cfb\u7edf\u4f1a\u81ea\u52a8\u5e94\u7528\u4ee5\u4e0b\u4f18\u5316\uff1a</p> <ul> <li>\u667a\u80fd\u8fc7\u6ee4: \u53bb\u9664\u5df2\u77e5\u7684\u4f4e\u8d28\u91cf\u6216\u5931\u6548\u6e90\u3002</li> <li>\u5e7f\u544a\u5c4f\u853d: \u81ea\u52a8\u5408\u5e76 58+ \u6761\u5e7f\u544a\u8fc7\u6ee4\u89c4\u5219\uff0c\u5305\u62ec\u6076\u610f TS \u5207\u7247\u548c\u5e38\u89c1\u5e7f\u544a\u57df\u540d\u3002</li> <li>DNS \u4f18\u5316: \u542f\u7528 DoH (DNS over HTTPS)\uff0c\u63a8\u8350\u4f7f\u7528 Google DNS \u6216 Cloudflare DNS \u63d0\u5347\u89e3\u6790\u901f\u5ea6\u548c\u9690\u79c1\u3002</li> <li>\u89e3\u7801\u4f18\u5316: \u6839\u636e\u6e90\u7c7b\u578b\u63a8\u8350\u8f6f\u89e3/\u786c\u89e3\u914d\u7f6e\u3002</li> </ul>"},{"location":"MANUAL/#4-technical-reference","title":"4. \u6280\u672f\u539f\u7406 (Technical Reference)","text":"<p>\u57fa\u4e8e\u5bf9 TVBox \u6e90\u7801\u7684\u6df1\u5ea6\u5206\u6790\uff0c\u5e2e\u52a9\u60a8\u7406\u89e3\u914d\u7f6e\u80cc\u540e\u7684\u673a\u5236\u3002</p>"},{"location":"MANUAL/#41","title":"4.1 \u63d2\u4ef6\u52a0\u8f7d\u673a\u5236","text":"<p>TVBox \u91c7\u7528\u63d2\u4ef6\u5316\u67b6\u6784\uff0c\u6839\u636e <code>api</code> \u5b57\u6bb5\u7684\u524d\u7f00\u6216\u540e\u7f00\u8c03\u7528\u4e0d\u540c\u7684\u52a0\u8f7d\u5668\uff1a</p> <ol> <li> <p>JarLoader (Java/JAR)</p> <ul> <li>\u89e6\u53d1\u6761\u4ef6: <code>api</code> \u4ee5 <code>csp_</code> \u5f00\u5934 (\u5982 <code>csp_XBPQ</code>) \u6216\u6307\u5b9a\u4e86 <code>jar</code> \u5b57\u6bb5\u3002</li> <li>\u539f\u7406: \u4f7f\u7528 Android <code>DexClassLoader</code> \u52a8\u6001\u52a0\u8f7d JAR/DEX \u6587\u4ef6\u3002\u652f\u6301 <code>com.github.catvod.spider.Init</code> \u521d\u59cb\u5316\u3002</li> <li>\u7279\u70b9: \u6027\u80fd\u6700\u9ad8\uff0c\u652f\u6301 MD5 \u5b8c\u6574\u6027\u6821\u9a8c (\u9632\u6b62\u7be1\u6539)\u3002</li> </ul> </li> <li> <p>JsLoader (JavaScript)</p> <ul> <li>\u89e6\u53d1\u6761\u4ef6: <code>api</code> \u5305\u542b <code>.js</code>\u3002</li> <li>\u539f\u7406: \u57fa\u4e8e QuickJS \u5f15\u64ce\u6267\u884c\u3002\u652f\u6301 ES6 \u6a21\u5757\u548c Base64 \u7f16\u7801 (\u4ee5 <code>//bb</code> \u6216 <code>//DRPY</code> \u5f00\u5934)\u3002</li> <li>\u7279\u70b9: \u66f4\u65b0\u7075\u6d3b\uff0c\u652f\u6301\u70ed\u4fee\u590d\uff0c\u4f46\u6027\u80fd\u7565\u4f4e\u4e8e Java\u3002</li> </ul> </li> <li> <p>PyLoader (Python)</p> <ul> <li>\u89e6\u53d1\u6761\u4ef6: <code>api</code> \u5305\u542b <code>.py</code>\u3002</li> <li>\u539f\u7406: \u901a\u8fc7 <code>pyramid</code> \u6a21\u5757\u63d0\u4f9b\u7684 Python \u73af\u5883\u6267\u884c\u3002</li> <li>\u7279\u70b9: \u9002\u5408\u79fb\u690d\u722c\u866b\uff0c\u5e93\u652f\u6301\u4e30\u5bcc\u3002</li> </ul> </li> </ol>"},{"location":"MANUAL/#42","title":"4.2 \u6838\u5fc3\u914d\u7f6e\u8be6\u89e3","text":"<p><code>config.json</code> \u4e2d\u7684\u5b57\u6bb5\u76f4\u63a5\u6620\u5c04\u5230 App \u7684 Java Bean\uff1a</p> <ul> <li>type: \u7ad9\u70b9\u7c7b\u578b<ul> <li><code>0</code>: \u5f71\u89c6 (CMS/XML)</li> <li><code>1</code>: \u76f4\u64ad (IPTV)</li> <li><code>2</code>: \u89e3\u6790 (Parse)</li> <li><code>3</code>: \u722c\u866b (Spider - \u6838\u5fc3\u7c7b\u578b)</li> <li><code>4</code>: XPath</li> </ul> </li> <li>ext: \u6269\u5c55\u53c2\u6570<ul> <li>\u4f20\u9012\u7ed9 Spider <code>init</code> \u65b9\u6cd5\u7684\u53c2\u6570\u3002\u53ef\u4ee5\u662f JSON \u5b57\u7b26\u4e32\u3001Base64 \u6216\u8fdc\u7a0b URL\u3002</li> </ul> </li> <li>style:\u7528\u4e8e\u6307\u5b9aUI\u5e03\u5c40\u6837\u5f0f (\u5982 <code>{\"type\":\"rect\"}</code> \u77e9\u5f62\u6d77\u62a5)\u3002</li> </ul>"},{"location":"MANUAL/#43","title":"4.3 \u7f13\u5b58\u4e0e\u5b89\u5168","text":"<ul> <li>\u7f13\u5b58: App \u4f7f\u7528 Hawk \u5e93\u548c\u6587\u4ef6\u7f13\u5b58\u3002\u914d\u7f6e\u548c JAR \u90fd\u6709 MD5 \u6821\u9a8c\u673a\u5236\u3002</li> <li>\u7f51\u7edc: \u5e95\u5c42\u4f7f\u7528 OkHttp\uff0c\u6211\u4eec\u7684 <code>unified_manager.py</code> \u751f\u6210\u7684\u914d\u7f6e\u4f18\u5316\u4e86 DoH\uff0c\u5229\u7528 OkHttp \u7684 DNS over HTTPS \u80fd\u529b\u6297 DNS \u6c61\u67d3\u3002</li> </ul>"},{"location":"MANUAL/#5","title":"5. \u6545\u969c\u6392\u67e5","text":"<p>Q: \u9a8c\u8bc1\u5931\u8d25 (\"Validation Failed\") A: \u8bf7\u68c0\u67e5\u7f51\u7edc\u3002\u90e8\u5206\u6e90\u53ef\u80fd\u4f1a\u5c4f\u853d\u975e\u5bb6\u5ead\u5bbd\u5e26 IP (\u5982\u670d\u52a1\u5668 IP)\uff0c\u60a8\u53ef\u4ee5\u5c1d\u8bd5\u5728\u672c\u5730\u7535\u8111\u8fd0\u884c\u6216\u4f7f\u7528\u4ee3\u7406\u3002</p> <p>Q: \u7f3a\u5c11\u4f9d\u8d56 (\"Missing Dependencies\") A: \u8bf7\u786e\u4fdd\u5df2\u5b89\u88c5\u6240\u6709 Python \u4f9d\u8d56\uff1a<code>pip install -r requirements.txt</code>\u3002</p> <p>Q: \u5bfc\u5165\u9519\u8bef (\"ImportError\") A: \u8bf7\u5728 <code>boxext</code> \u6839\u76ee\u5f55\u4e0b\u8fd0\u884c\u811a\u672c\uff0c\u4e0d\u8981\u8fdb\u5165 <code>core/</code> \u76ee\u5f55\u8fd0\u884c\u3002</p> <p>Q: \u4e3a\u4ec0\u4e48\u751f\u6210\u7684\u914d\u7f6e\u65e0\u6cd5\u64ad\u653e\uff1f A: 1.  \u68c0\u67e5\u751f\u6210\u7684 <code>jar</code> \u76ee\u5f55\u662f\u5426\u6709\u6587\u4ef6\u3002 2.  \u786e\u4fdd\u60a8\u7684\u670d\u52a1\u5668\u80fd\u591f\u6b63\u786e\u54cd\u5e94 \".json\", \".jar\", \".js\" \u6587\u4ef6\u7684\u8bf7\u6c42 (MIME Type)\u3002</p> <p>\u672c\u6587\u6863\u66ff\u4ee3\u4e86\u65e7\u7248\u7684 <code>QUICK_REFERENCE.md</code>, <code>USAGE_GUIDE.md</code>, \u548c <code>QUICK_START.md</code>\u3002</p>"},{"location":"box_analysis/","title":"TvBox \u9879\u76ee\u5206\u6790\u62a5\u544a","text":""},{"location":"box_analysis/#_1","title":"\u9879\u76ee\u6982\u51b5","text":"<p>TvBox \u662f\u4e00\u4e2a\u57fa\u4e8e Android TV \u7684\u89c6\u9891\u64ad\u653e\u5e94\u7528\u7a0b\u5e8f\uff08TVBox\uff09\uff0c\u4e3b\u8981\u7528\u4e8e\u805a\u5408\u548c\u64ad\u653e\u5404\u79cd\u5728\u7ebf\u89c6\u9891\u5185\u5bb9\u3002\u8be5\u9879\u76ee\u91c7\u7528\u4e86\u63d2\u4ef6\u5316\u67b6\u6784\uff0c\u652f\u6301\u901a\u8fc7\u5916\u90e8\u914d\u7f6e\u6587\u4ef6\u52a8\u6001\u52a0\u8f7d\u89c6\u9891\u6e90\uff08Spider\uff09\u3002</p>"},{"location":"box_analysis/#_2","title":"\u6838\u5fc3\u7279\u70b9","text":"<ul> <li>\u591a\u683c\u5f0f\u652f\u6301: \u652f\u6301 IJK\u3001Exo\u3001\u7cfb\u7edf\u64ad\u653e\u5668\u7b49\u591a\u79cd\u64ad\u653e\u5668</li> <li>\u63d2\u4ef6\u5316: \u652f\u6301 Java/JAR\u3001JavaScript\u3001Python \u4e09\u79cd\u7c7b\u578b\u7684\u722c\u866b\u63d2\u4ef6</li> <li>\u52a8\u6001\u914d\u7f6e: \u901a\u8fc7 JSON \u914d\u7f6e\u6587\u4ef6\u52a8\u6001\u52a0\u8f7d\u89c6\u9891\u6e90</li> <li>Android TV \u4f18\u5316: \u4e13\u4e3a\u7535\u89c6\u5927\u5c4f\u8bbe\u8ba1\u7684\u6a2a\u5c4f\u754c\u9762</li> <li>\u76f4\u64ad\u529f\u80fd: \u652f\u6301 IPTV \u76f4\u64ad\u9891\u9053</li> </ul>"},{"location":"box_analysis/#_3","title":"\u9879\u76ee\u67b6\u6784","text":""},{"location":"box_analysis/#_4","title":"\u6a21\u5757\u7ec4\u6210","text":"<pre><code>Box/\n\u251c\u2500\u2500 app/                          # \u4e3b\u5e94\u7528\u6a21\u5757\n\u2502   \u251c\u2500\u2500 src/main/java/\n\u2502   \u2502   \u2514\u2500\u2500 com/github/tvbox/osc/\n\u2502   \u2502       \u251c\u2500\u2500 api/             # API\u914d\u7f6e\u7ba1\u7406\n\u2502   \u2502       \u251c\u2500\u2500 base/            # \u5e94\u7528\u57fa\u7840\u7c7b\n\u2502   \u2502       \u251c\u2500\u2500 player/          # \u64ad\u653e\u5668\u76f8\u5173\n\u2502   \u2502       \u251c\u2500\u2500 ui/              # \u7528\u6237\u754c\u9762\n\u2502   \u2502       \u2514\u2500\u2500 util/            # \u5de5\u5177\u7c7b\n\u2502   \u2514\u2500\u2500 src/main/assets/         # \u8d44\u6e90\u6587\u4ef6\n\u251c\u2500\u2500 quickjs/                     # QuickJS JavaScript\u5f15\u64ce\n\u2514\u2500\u2500 pyramid/                     # Python\u652f\u6301\u6a21\u5757\n</code></pre>"},{"location":"box_analysis/#_5","title":"\u6574\u4f53\u67b6\u6784\u56fe","text":"<pre><code>graph TB\n    subgraph \"\u5e94\u7528\u5c42 UI Layer\"\n        A[HomeActivity&lt;br/&gt;\u9996\u9875]\n        B[DetailActivity&lt;br/&gt;\u8be6\u60c5\u9875]\n        C[PlayActivity&lt;br/&gt;\u64ad\u653e\u9875]\n        D[SearchActivity&lt;br/&gt;\u641c\u7d22\u9875]\n    end\n\n    subgraph \"\u4e1a\u52a1\u903b\u8f91\u5c42 Business Layer\"\n        E[ApiConfig&lt;br/&gt;\u914d\u7f6e\u7ba1\u7406]\n        F[SourceBean&lt;br/&gt;\u89c6\u9891\u6e90]\n        G[ParseBean&lt;br/&gt;\u89e3\u6790\u914d\u7f6e]\n    end\n\n    subgraph \"\u63d2\u4ef6\u52a0\u8f7d\u5c42 Plugin Loader\"\n        H[JarLoader&lt;br/&gt;Java\u63d2\u4ef6\u52a0\u8f7d\u5668]\n        I[JsLoader&lt;br/&gt;JS\u63d2\u4ef6\u52a0\u8f7d\u5668]\n        J[PyLoader&lt;br/&gt;Python\u63d2\u4ef6\u52a0\u8f7d\u5668]\n    end\n\n    subgraph \"\u63d2\u4ef6\u6267\u884c\u5c42 Spider Execution\"\n        K[Spider&lt;br/&gt;\u57fa\u7c7b\u63a5\u53e3]\n        L[JsSpider&lt;br/&gt;JS\u5b9e\u73b0]\n        M[PySpider&lt;br/&gt;Python\u5b9e\u73b0]\n        N[JavaSpider&lt;br/&gt;Java\u5b9e\u73b0]\n    end\n\n    subgraph \"\u5e95\u5c42\u652f\u6301 Infrastructure\"\n        O[QuickJS&lt;br/&gt;JS\u5f15\u64ce]\n        P[DexClassLoader&lt;br/&gt;\u52a8\u6001\u52a0\u8f7d]\n        Q[OkHttp&lt;br/&gt;\u7f51\u7edc\u8bf7\u6c42]\n    end\n\n    A --&gt; E\n    B --&gt; E\n    C --&gt; E\n    D --&gt; E\n\n    E --&gt; H\n    E --&gt; I\n    E --&gt; J\n\n    H --&gt; N\n    I --&gt; L\n    J --&gt; M\n\n    N --&gt; K\n    L --&gt; K\n    M --&gt; K\n\n    L --&gt; O\n    H --&gt; P\n    K --&gt; Q\n</code></pre>"},{"location":"box_analysis/#_6","title":"\u8fd0\u884c\u539f\u7406","text":""},{"location":"box_analysis/#_7","title":"\u5e94\u7528\u542f\u52a8\u6d41\u7a0b","text":"<pre><code>sequenceDiagram\n    participant App\n    participant ApiConfig\n    participant Loader\n    participant Spider\n\n    App-&gt;&gt;App: onCreate()\n    App-&gt;&gt;App: initParams()&lt;br/&gt;\u521d\u59cb\u5316\u9ed8\u8ba4\u914d\u7f6e\n    App-&gt;&gt;ApiConfig: loadConfig()\n    ApiConfig-&gt;&gt;ApiConfig: \u4e0b\u8f7d\u914d\u7f6e\u6587\u4ef6\n    ApiConfig-&gt;&gt;ApiConfig: parseJson()&lt;br/&gt;\u89e3\u6790\u914d\u7f6e\n    ApiConfig-&gt;&gt;Loader: loadJar()&lt;br/&gt;\u52a0\u8f7dJAR\u63d2\u4ef6\n    Loader-&gt;&gt;Loader: DexClassLoader\u52a0\u8f7d\n    Loader-&gt;&gt;Loader: \u7f13\u5b58ClassLoader\n    Note over ApiConfig: \u914d\u7f6e\u52a0\u8f7d\u5b8c\u6210\n    App-&gt;&gt;ApiConfig: getCSP(sourceBean)\n    ApiConfig-&gt;&gt;Loader: getSpider()\n    Loader-&gt;&gt;Spider: \u521b\u5efaSpider\u5b9e\u4f8b\n    Spider--&gt;&gt;App: \u8fd4\u56deSpider\u5bf9\u8c61\n</code></pre>"},{"location":"box_analysis/#_8","title":"\u6838\u5fc3\u8fd0\u884c\u673a\u5236","text":""},{"location":"box_analysis/#1-apiconfigjava","title":"1. \u914d\u7f6e\u7ba1\u7406 (ApiConfig.java)","text":"<p><code>ApiConfig</code> \u662f\u6574\u4e2a\u5e94\u7528\u7684\u914d\u7f6e\u4e2d\u5fc3\uff0c\u8d1f\u8d23\uff1a</p> <ul> <li>\u914d\u7f6e\u52a0\u8f7d: \u4ece\u8fdc\u7a0bURL\u6216\u672c\u5730\u7f13\u5b58\u52a0\u8f7dJSON\u914d\u7f6e</li> <li>\u914d\u7f6e\u89e3\u6790: \u89e3\u6790\u89c6\u9891\u6e90\u3001\u89e3\u6790\u5668\u3001\u76f4\u64ad\u6e90\u7b49\u914d\u7f6e</li> <li>\u63d2\u4ef6\u7ba1\u7406: \u6839\u636e\u89c6\u9891\u6e90\u7c7b\u578b\u8c03\u7528\u76f8\u5e94\u7684\u52a0\u8f7d\u5668</li> <li>\u7f13\u5b58\u7ba1\u7406: \u4f7f\u7528MD5\u54c8\u5e0c\u7f13\u5b58\u914d\u7f6e\u6587\u4ef6</li> </ul> <p>\u5173\u952e\u65b9\u6cd5: <pre><code>// \u52a0\u8f7d\u914d\u7f6e\npublic void loadConfig(boolean useCache, LoadConfigCallback callback, Activity activity)\n\n// \u52a0\u8f7dJAR\u63d2\u4ef6\npublic void loadJar(boolean useCache, String spider, LoadConfigCallback callback)\n\n// \u83b7\u53d6Spider\u5b9e\u4f8b\npublic Spider getCSP(SourceBean sourceBean)\n</code></pre></p>"},{"location":"box_analysis/#2","title":"2. \u6570\u636e\u6301\u4e45\u5316","text":"<p>\u4f7f\u7528 Hawk \u5e93\u8fdb\u884c\u914d\u7f6e\u6301\u4e45\u5316\u5b58\u50a8\uff1a</p> <pre><code>// \u9ed8\u8ba4\u914d\u7f6e\u5199\u5165\nprivate void putDefault(String key, Object value) {\n    if (!Hawk.contains(key)) {\n        Hawk.put(key, value);\n    }\n}\n</code></pre> <p>\u4e3b\u8981\u914d\u7f6e\u9879\u5305\u62ec\uff1a - <code>HOME_REC</code>: \u9996\u9875\u63a8\u8350\u7c7b\u578b\uff08\u8c46\u74e3/\u7ad9\u70b9\u63a8\u8350/\u5386\u53f2\uff09 - <code>PLAY_TYPE</code>: \u64ad\u653e\u5668\u7c7b\u578b\uff08\u7cfb\u7edf/IJK/Exo\uff09 - <code>IJK_CODEC</code>: IJK\u89e3\u7801\u65b9\u5f0f\uff08\u8f6f\u89e3\u7801/\u786c\u89e3\u7801\uff09 - <code>HOME_NUM</code>: \u5386\u53f2\u8bb0\u5f55\u6570\u91cf - <code>DOH_URL</code>: DNS over HTTPS\u8bbe\u7f6e</p>"},{"location":"box_analysis/#3","title":"3. \u7f51\u7edc\u8bf7\u6c42","text":"<p>\u4f7f\u7528 OkGo \u5c01\u88c5\u7684 OkHttp \u8fdb\u884c\u7f51\u7edc\u8bf7\u6c42\uff1a</p> <ul> <li>\u914d\u7f6e\u6587\u4ef6\u4e0b\u8f7d</li> <li>JAR/JS/Python\u6587\u4ef6\u4e0b\u8f7d</li> <li>\u89c6\u9891\u6e90API\u8c03\u7528</li> <li>\u652f\u6301DoH\uff08DNS over HTTPS\uff09</li> </ul>"},{"location":"box_analysis/#_9","title":"\u63d2\u4ef6\u673a\u5236\u8be6\u89e3","text":"<p>Box \u7684\u6838\u5fc3\u662f\u5176\u5f3a\u5927\u7684\u63d2\u4ef6\u7cfb\u7edf\uff0c\u652f\u6301\u4e09\u79cd\u7c7b\u578b\u7684\u722c\u866b\u63d2\u4ef6\uff1a</p>"},{"location":"box_analysis/#spider","title":"Spider \u57fa\u7c7b\u63a5\u53e3","text":"<p>\u6240\u6709\u63d2\u4ef6\u90fd\u9700\u8981\u5b9e\u73b0 Spider.java \u57fa\u7c7b\u5b9a\u4e49\u7684\u63a5\u53e3\uff1a</p> <pre><code>public class Spider {\n    // \u521d\u59cb\u5316\n    public void init(Context context, String extend) throws Exception\n\n    // \u9996\u9875\u5185\u5bb9\n    public String homeContent(boolean filter) throws Exception\n\n    // \u9996\u9875\u89c6\u9891\n    public String homeVideoContent() throws Exception\n\n    // \u5206\u7c7b\u5185\u5bb9\n    public String categoryContent(String tid, String pg, boolean filter, \n                                  HashMap&lt;String, String&gt; extend) throws Exception\n\n    // \u8be6\u60c5\u5185\u5bb9\n    public String detailContent(List&lt;String&gt; ids) throws Exception\n\n    // \u641c\u7d22\u5185\u5bb9\n    public String searchContent(String key, boolean quick) throws Exception\n\n    // \u64ad\u653e\u4fe1\u606f\n    public String playerContent(String flag, String id, \n                               List&lt;String&gt; vipFlags) throws Exception\n\n    // \u672c\u5730\u4ee3\u7406\n    public Object[] proxyLocal(Map&lt;String, String&gt; params) throws Exception\n}\n</code></pre>"},{"location":"box_analysis/#1-javajar","title":"1. Java/JAR \u63d2\u4ef6\u673a\u5236","text":""},{"location":"box_analysis/#jarloaderjava","title":"\u52a0\u8f7d\u5668: JarLoader.java","text":"<p>\u5de5\u4f5c\u6d41\u7a0b:</p> <pre><code>flowchart TD\n    A[\u5f00\u59cb\u52a0\u8f7dJAR] --&gt; B{\u68c0\u67e5\u7f13\u5b58}\n    B --&gt;|\u5df2\u7f13\u5b58| C[\u8fd4\u56de\u7f13\u5b58\u7684ClassLoader]\n    B --&gt;|\u672a\u7f13\u5b58| D[\u4e0b\u8f7dJAR\u6587\u4ef6]\n    D --&gt; E[\u4fdd\u5b58\u5230\u672c\u5730\u7f13\u5b58]\n    E --&gt; F[\u4f7f\u7528DexClassLoader\u52a0\u8f7d]\n    F --&gt; G[\u8c03\u7528Init\u7c7b\u7684init\u65b9\u6cd5]\n    G --&gt; H[\u52a0\u8f7dProxy\u7c7b&lt;br/&gt;\u53ef\u9009]\n    H --&gt; I[\u7f13\u5b58ClassLoader]\n    I --&gt; J{\u9700\u8981Spider?}\n    J --&gt;|\u662f| K[loadClass\u52a0\u8f7dSpider\u7c7b]\n    K --&gt; L[\u521b\u5efaSpider\u5b9e\u4f8b]\n    L --&gt; M[\u8c03\u7528init\u521d\u59cb\u5316]\n    M --&gt; N[\u7f13\u5b58Spider\u5b9e\u4f8b]\n    J --&gt;|\u5426| C\n    N --&gt; C\n</code></pre> <p>\u5173\u952e\u4ee3\u7801:</p> <pre><code>public class JarLoader {\n    // ClassLoader\u7f13\u5b58\n    private final ConcurrentHashMap&lt;String, DexClassLoader&gt; classLoaders;\n\n    // Spider\u5b9e\u4f8b\u7f13\u5b58\n    private final ConcurrentHashMap&lt;String, Spider&gt; spiders;\n\n    // \u52a0\u8f7dJAR\u5e76\u521d\u59cb\u5316\n    private boolean loadClassLoader(String jar, String key) {\n        File cacheDir = new File(App.getInstance().getCacheDir() + \"/catvod_csp\");\n        DexClassLoader classLoader = new DexClassLoader(jar, \n            cacheDir.getAbsolutePath(), null, App.getInstance().getClassLoader());\n\n        // \u52a0\u8f7dInit\u7c7b\u5e76\u8c03\u7528init\u65b9\u6cd5\n        Class&lt;?&gt; classInit = classLoader.loadClass(\"com.github.catvod.spider.Init\");\n        Method initMethod = classInit.getMethod(\"init\", Context.class);\n        initMethod.invoke(null, App.getInstance());\n\n        // \u52a0\u8f7dProxy\u7c7b\uff08\u53ef\u9009\uff09\n        Class&lt;?&gt; proxy = classLoader.loadClass(\"com.github.catvod.spider.Proxy\");\n        Method proxyMethod = proxy.getMethod(\"proxy\", Map.class);\n\n        classLoaders.put(key, classLoader);\n        return true;\n    }\n\n    // \u83b7\u53d6Spider\u5b9e\u4f8b\n    public Spider getSpider(String key, String cls, String ext, String jar) {\n        // \u79fb\u9664\"csp_\"\u524d\u7f00\n        String clsKey = cls.replace(\"csp_\", \"\");\n\n        // \u52a0\u8f7dSpider\u7c7b\n        Spider sp = (Spider) classLoader.loadClass(\n            \"com.github.catvod.spider.\" + clsKey).newInstance();\n        sp.init(App.getInstance(), ext);\n\n        spiders.put(key, sp);\n        return sp;\n    }\n}\n</code></pre> <p>\u7279\u70b9: - \u4f7f\u7528 <code>DexClassLoader</code> \u52a8\u6001\u52a0\u8f7d\u5916\u90e8JAR - \u652f\u6301MD5\u6821\u9a8c\u786e\u4fdd\u6587\u4ef6\u5b8c\u6574\u6027 - \u4e09\u7ea7\u7f13\u5b58\u7b56\u7565\uff1aClassLoader\u7f13\u5b58\u3001Spider\u5b9e\u4f8b\u7f13\u5b58\u3001\u6587\u4ef6\u7f13\u5b58 - \u652f\u6301\u81ea\u5b9a\u4e49\u521d\u59cb\u5316\uff08Init\u7c7b\uff09\u548c\u4ee3\u7406\uff08Proxy\u7c7b\uff09</p>"},{"location":"box_analysis/#2-javascript","title":"2. JavaScript \u63d2\u4ef6\u673a\u5236","text":""},{"location":"box_analysis/#jsloaderjava","title":"\u52a0\u8f7d\u5668: JsLoader.java","text":"<p>\u6838\u5fc3\u6280\u672f: \u4f7f\u7528 QuickJS JavaScript\u5f15\u64ce\u6267\u884cJS\u4ee3\u7801</p> <p>\u5de5\u4f5c\u6d41\u7a0b:</p> <pre><code>flowchart TD\n    A[\u5f00\u59cb\u52a0\u8f7dJS] --&gt; B{\u6709jar\u53c2\u6570?}\n    B --&gt;|\u6709| C[\u4e0b\u8f7d\u5e76\u52a0\u8f7djar&lt;br/&gt;\u5305\u542b\u6269\u5c55API]\n    B --&gt;|\u65e0| D[\u76f4\u63a5\u52a0\u8f7dJS\u6587\u4ef6]\n    C --&gt; D\n    D --&gt; E[\u521b\u5efaJsSpider\u5b9e\u4f8b]\n    E --&gt; F[\u521d\u59cb\u5316QuickJS\u4e0a\u4e0b\u6587]\n    F --&gt; G[\u52a0\u8f7dJS\u6a21\u5757]\n    G --&gt; H{JS\u683c\u5f0f?}\n    H --&gt;|base64\u7f16\u7801&lt;br/&gt;//bb| I[\u89e3\u7801\u5e76\u6267\u884c]\n    H --&gt;|ES6\u6a21\u5757&lt;br/&gt;export default| J[evaluateModule]\n    H --&gt;|DRPY\u683c\u5f0f| K[\u52a0\u8f7d\u5b57\u8282\u7801]\n    I --&gt; L[\u6ce8\u518c\u5168\u5c40Spider\u5bf9\u8c61]\n    J --&gt; L\n    K --&gt; L\n    L --&gt; M[\u7f13\u5b58Spider\u5b9e\u4f8b]\n</code></pre>"},{"location":"box_analysis/#jsspiderjava","title":"\u5b9e\u73b0: JsSpider.java","text":"<p>QuickJS \u96c6\u6210:</p> <pre><code>public class JsSpider extends Spider {\n    private QuickJSContext ctx;\n    private JSObject jsObject;\n    private final ExecutorService executor;\n\n    // \u521d\u59cb\u5316QuickJS\u4e0a\u4e0b\u6587\n    private void createCtx() {\n        ctx = QuickJSContext.create();\n\n        // \u8bbe\u7f6e\u6a21\u5757\u52a0\u8f7d\u5668\n        ctx.setModuleLoader(new QuickJSContext.BytecodeModuleLoader() {\n            @Override\n            public byte[] getModuleBytecode(String moduleName) {\n                String content = FileUtils.loadModule(moduleName);\n                // \u652f\u6301\u591a\u79cd\u683c\u5f0f\n                if (content.startsWith(\"//DRPY\")) {\n                    return Base64.decode(content.replace(\"//DRPY\",\"\"), URL_SAFE);\n                } else if (content.startsWith(\"//bb\")) {\n                    return byteFF(Base64.decode(content.replace(\"//bb\",\"\"), 0));\n                } else {\n                    return ctx.compileModule(content, moduleName);\n                }\n            }\n        });\n\n        // \u7ed1\u5b9a\u5168\u5c40\u5bf9\u8c61\n        ctx.getGlobalObject().bind(new Global(executor));\n\n        // \u6ce8\u5165\u7f51\u7edc\u8bf7\u6c42\u80fd\u529b\n        ctx.getGlobalObject().evaluate(FileUtils.loadModule(\"net.js\"));\n    }\n\n    // \u8c03\u7528JS\u65b9\u6cd5\n    private Object call(String func, Object... args) {\n        return executor.submit(() -&gt; \n            Async.run(jsObject, func, args).get()\n        ).get();\n    }\n\n    // \u5b9e\u73b0Spider\u63a5\u53e3\n    @Override\n    public String homeContent(boolean filter) {\n        return (String) call(\"home\", filter);\n    }\n}\n</code></pre> <p>\u7279\u70b9: - \u4f7f\u7528\u5355\u7ebf\u7a0b ExecutorService \u6267\u884c\u6240\u6709JS\u8c03\u7528\uff0c\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168 - \u652f\u6301ES6\u6a21\u5757\u7cfb\u7edf - \u652f\u6301base64\u7f16\u7801\u7684JS\u4ee3\u7801\uff08\u52a0\u5bc6\u4fdd\u62a4\uff09 - \u53ef\u9009\u7684jar\u6269\u5c55\uff0c\u63d0\u4f9b\u989d\u5916\u7684Java API\u7ed9JS\u8c03\u7528 - \u5185\u7f6e\u7f51\u7edc\u8bf7\u6c42\u3001JSON\u89e3\u6790\u7b49\u80fd\u529b</p>"},{"location":"box_analysis/#3-python","title":"3. Python \u63d2\u4ef6\u673a\u5236","text":""},{"location":"box_analysis/#ipyloaderjava","title":"\u63a5\u53e3: IPyLoader.java","text":"<pre><code>public interface IPyLoader {\n    void clear();\n    void setConfig(String jsonStr);\n    void setRecentPyKey(String pyApi);\n    Spider getSpider(String key, String cls, String ext);\n    Object[] proxyInvoke(Map&lt;String, String&gt; params);\n}\n</code></pre> <p>\u7279\u70b9: - \u901a\u8fc7 <code>pyramid</code> \u6a21\u5757\u63d0\u4f9bPython\u8fd0\u884c\u73af\u5883 - \u652f\u6301Python\u811a\u672c\u52a8\u6001\u52a0\u8f7d\u548c\u6267\u884c - \u9700\u8981\u989d\u5916\u7684Python\u89e3\u91ca\u5668\u652f\u6301</p>"},{"location":"box_analysis/#_10","title":"\u63d2\u4ef6\u7c7b\u578b\u5224\u65ad","text":"<p>\u5728 ApiConfig.java \u4e2d\u6839\u636eAPI\u8def\u5f84\u5224\u65ad\u63d2\u4ef6\u7c7b\u578b\uff1a</p> <pre><code>public Spider getCSP(SourceBean sourceBean) {\n    String api = sourceBean.getApi();\n\n    // JavaScript\u63d2\u4ef6\n    if (api.endsWith(\".js\") || api.contains(\".js?\")) {\n        return jsLoader.getSpider(sourceBean.getKey(), api, \n                                 sourceBean.getExt(), sourceBean.getJar());\n    }\n    // Python\u63d2\u4ef6\n    else if (api.contains(\".py\")) {\n        return pyLoader.getSpider(sourceBean.getKey(), api, \n                                 sourceBean.getExt());\n    }\n    // Java\u63d2\u4ef6\n    else {\n        return jarLoader.getSpider(sourceBean.getKey(), api, \n                                  sourceBean.getExt(), sourceBean.getJar());\n    }\n}\n</code></pre>"},{"location":"box_analysis/#_11","title":"\u914d\u7f6e\u6587\u4ef6\u683c\u5f0f","text":""},{"location":"box_analysis/#json","title":"JSON\u914d\u7f6e\u7ed3\u6784","text":"<pre><code>{\n  \"spider\": \"http://example.com/spider.jar;md5;hash\u503c\",\n  \"wallpaper\": \"http://example.com/wallpaper.jpg\",\n  \"sites\": [\n    {\n      \"key\": \"unique_key\",\n      \"name\": \"\u89c6\u9891\u6e90\u540d\u79f0\",\n      \"type\": 3,\n      \"api\": \"csp_XPath\",\n      \"searchable\": 1,\n      \"quickSearch\": 1,\n      \"filterable\": 1,\n      \"ext\": \"\u914d\u7f6e\u6269\u5c55\u53c2\u6570\",\n      \"jar\": \"http://example.com/custom.jar\"\n    }\n  ],\n  \"parses\": [\n    {\n      \"name\": \"\u89e3\u6790\u5668\u540d\u79f0\",\n      \"url\": \"\u89e3\u6790\u5668URL\",\n      \"type\": 0,\n      \"ext\": {}\n    }\n  ],\n  \"lives\": [\n    {\n      \"group\": \"\u9891\u9053\u7ec4\u540d\",\n      \"channels\": [\n        {\n          \"name\": \"\u9891\u9053\u540d\",\n          \"urls\": [\"http://example.com/live.m3u8\"]\n        }\n      ]\n    }\n  ]\n}\n</code></pre>"},{"location":"box_analysis/#type","title":"\u7ad9\u70b9\u7c7b\u578b (type)","text":"<ul> <li>0: \u5f71\u89c6</li> <li>1: \u76f4\u64ad</li> <li>2: \u89e3\u6790</li> <li>3: \u722c\u866b\uff08Spider\uff09</li> <li>4: XPath</li> </ul>"},{"location":"box_analysis/#ext","title":"\u63d2\u4ef6\u6269\u5c55 (ext)","text":"<p><code>ext</code> \u5b57\u6bb5\u7528\u4e8e\u4f20\u9012\u63d2\u4ef6\u7279\u5b9a\u7684\u914d\u7f6e\u53c2\u6570\uff0c\u53ef\u4ee5\u662f\uff1a - JSON\u5b57\u7b26\u4e32 - Base64\u7f16\u7801\u7684\u914d\u7f6e - \u6587\u4ef6URL</p>"},{"location":"box_analysis/#_12","title":"\u6570\u636e\u6d41\u8f6c","text":""},{"location":"box_analysis/#_13","title":"\u89c6\u9891\u64ad\u653e\u6d41\u7a0b","text":"<pre><code>sequenceDiagram\n    participant User\n    participant UI\n    participant ApiConfig\n    participant Spider\n    participant Player\n\n    User-&gt;&gt;UI: \u9009\u62e9\u89c6\u9891\u6e90\n    UI-&gt;&gt;ApiConfig: getCSP(sourceBean)\n    ApiConfig-&gt;&gt;Spider: \u521b\u5efa/\u83b7\u53d6Spider\n\n    User-&gt;&gt;UI: \u6d4f\u89c8\u9996\u9875\n    UI-&gt;&gt;Spider: homeContent(filter)\n    Spider-&gt;&gt;Spider: \u8bf7\u6c42\u89c6\u9891\u7f51\u7ad9API\n    Spider--&gt;&gt;UI: \u8fd4\u56deJSON\u6570\u636e\n\n    User-&gt;&gt;UI: \u70b9\u51fb\u89c6\u9891\n    UI-&gt;&gt;Spider: detailContent(ids)\n    Spider--&gt;&gt;UI: \u8fd4\u56de\u89c6\u9891\u8be6\u60c5\n\n    User-&gt;&gt;UI: \u9009\u62e9\u64ad\u653e\n    UI-&gt;&gt;Spider: playerContent(flag, id, vipFlags)\n    Spider-&gt;&gt;Spider: \u89e3\u6790\u64ad\u653e\u5730\u5740\n    Spider--&gt;&gt;UI: \u8fd4\u56de\u64ad\u653eURL\n\n    UI-&gt;&gt;Player: \u64ad\u653e\u89c6\u9891\n    Player-&gt;&gt;Player: IJK/Exo\u64ad\u653e\n</code></pre>"},{"location":"box_analysis/#_14","title":"\u641c\u7d22\u6d41\u7a0b","text":"<pre><code>flowchart LR\n    A[\u7528\u6237\u8f93\u5165\u5173\u952e\u8bcd] --&gt; B[\u904d\u5386\u6240\u6709\u53ef\u641c\u7d22\u6e90]\n    B --&gt; C1[Spider1.searchContent]\n    B --&gt; C2[Spider2.searchContent]\n    B --&gt; C3[Spider3.searchContent]\n    C1 --&gt; D[\u5408\u5e76\u641c\u7d22\u7ed3\u679c]\n    C2 --&gt; D\n    C3 --&gt; D\n    D --&gt; E[\u5c55\u793a\u641c\u7d22\u7ed3\u679c]\n</code></pre>"},{"location":"box_analysis/#_15","title":"\u6838\u5fc3\u6280\u672f\u603b\u7ed3","text":""},{"location":"box_analysis/#1","title":"1. \u52a8\u6001\u52a0\u8f7d\u6280\u672f","text":"<ul> <li>DexClassLoader: \u52a8\u6001\u52a0\u8f7d\u5916\u90e8DEX/JAR\u6587\u4ef6</li> <li>QuickJS: \u5d4c\u5165\u5f0fJavaScript\u5f15\u64ce</li> <li>\u53cd\u5c04\u673a\u5236: \u52a8\u6001\u8c03\u7528\u63d2\u4ef6\u65b9\u6cd5</li> </ul>"},{"location":"box_analysis/#2_1","title":"2. \u7f13\u5b58\u7b56\u7565","text":"<ul> <li>\u4e09\u7ea7\u7f13\u5b58:</li> <li>\u5185\u5b58\u7f13\u5b58\uff08ConcurrentHashMap\uff09</li> <li>\u6587\u4ef6\u7f13\u5b58\uff08\u672c\u5730\u5b58\u50a8\uff09</li> <li> <p>\u8fdc\u7a0b\u62c9\u53d6</p> </li> <li> <p>\u7f13\u5b58Key: \u4f7f\u7528MD5\u54c8\u5e0c\u751f\u6210\u552f\u4e00\u6807\u8bc6</p> </li> </ul>"},{"location":"box_analysis/#3_1","title":"3. \u7ebf\u7a0b\u7ba1\u7406","text":"<ul> <li>ExecutorService: \u7ba1\u7406\u63d2\u4ef6\u6267\u884c\u7ebf\u7a0b</li> <li>\u5f02\u6b65\u52a0\u8f7d: \u907f\u514d\u4e3b\u7ebf\u7a0b\u963b\u585e</li> <li>Future\u6a21\u5f0f: \u7b49\u5f85\u5f02\u6b65\u7ed3\u679c</li> </ul>"},{"location":"box_analysis/#4","title":"4. \u5b89\u5168\u673a\u5236","text":"<ul> <li>MD5\u6821\u9a8c: \u9a8c\u8bc1JAR\u6587\u4ef6\u5b8c\u6574\u6027</li> <li>Base64\u7f16\u7801: JS\u4ee3\u7801\u52a0\u5bc6\u4fdd\u62a4</li> <li>\u6c99\u7bb1\u9694\u79bb: QuickJS\u8fd0\u884c\u5728\u72ec\u7acb\u4e0a\u4e0b\u6587</li> </ul>"},{"location":"box_analysis/#_16","title":"\u63d2\u4ef6\u5f00\u53d1\u6307\u5357","text":""},{"location":"box_analysis/#java","title":"Java\u63d2\u4ef6\u5f00\u53d1","text":"<ol> <li> <p>\u7ee7\u627fSpider\u57fa\u7c7b: <pre><code>package com.github.catvod.spider;\n\npublic class MySpider extends Spider {\n    @Override\n    public void init(Context context, String extend) {\n        // \u521d\u59cb\u5316\u903b\u8f91\n    }\n\n    @Override\n    public String homeContent(boolean filter) {\n        // \u8fd4\u56de\u9996\u9875\u5185\u5bb9JSON\n        return \"{\\\"class\\\":[...], \\\"list\\\":[...]}\";\n    }\n}\n</code></pre></p> </li> <li> <p>\u7f16\u8bd1\u4e3aJAR: \u6253\u5305\u6210JAR\u6216DEX\u683c\u5f0f</p> </li> <li> <p>\u914d\u7f6e\u6587\u4ef6: <pre><code>{\n  \"key\": \"my_source\",\n  \"name\": \"\u6211\u7684\u89c6\u9891\u6e90\",\n  \"type\": 3,\n  \"api\": \"csp_MySpider\",\n  \"jar\": \"http://example.com/myspider.jar\"\n}\n</code></pre></p> </li> </ol>"},{"location":"box_analysis/#javascript","title":"JavaScript\u63d2\u4ef6\u5f00\u53d1","text":"<pre><code>// \u5bfc\u51faSpider\u5bf9\u8c61\nexport default {\n    async init(cfg) {\n        // \u521d\u59cb\u5316\n    },\n\n    async home(filter) {\n        // \u9996\u9875\u5185\u5bb9\n        return JSON.stringify({\n            class: [...],\n            list: [...]\n        });\n    },\n\n    async category(tid, pg, filter, extend) {\n        // \u5206\u7c7b\u5185\u5bb9\n    },\n\n    async detail(id) {\n        // \u8be6\u60c5\n    },\n\n    async play(flag, id, vipFlags) {\n        // \u64ad\u653e\u5730\u5740\n        return JSON.stringify({\n            url: \"\u64ad\u653e\u5730\u5740\"\n        });\n    },\n\n    async search(wd, quick) {\n        // \u641c\u7d22\n    }\n};\n</code></pre>"},{"location":"box_analysis/#_17","title":"\u603b\u7ed3","text":"<p>Box\u9879\u76ee\u901a\u8fc7\u7cbe\u5fc3\u8bbe\u8ba1\u7684\u63d2\u4ef6\u5316\u67b6\u6784\uff0c\u5b9e\u73b0\u4e86\u9ad8\u5ea6\u7684\u6269\u5c55\u6027\u548c\u7075\u6d3b\u6027\uff1a</p>"},{"location":"box_analysis/#_18","title":"\u4f18\u52bf","text":"<ol> <li>\u591a\u8bed\u8a00\u652f\u6301: Java\u3001JavaScript\u3001Python\u4e09\u79cd\u63d2\u4ef6\u7c7b\u578b</li> <li>\u52a8\u6001\u66f4\u65b0: \u65e0\u9700\u91cd\u65b0\u5b89\u88c5\u5e94\u7528\u5373\u53ef\u66f4\u65b0\u89c6\u9891\u6e90</li> <li>\u9ad8\u6027\u80fd: \u591a\u7ea7\u7f13\u5b58\u3001\u5f02\u6b65\u52a0\u8f7d</li> <li>\u6613\u6269\u5c55: \u6e05\u6670\u7684Spider\u63a5\u53e3\u5b9a\u4e49</li> <li>\u793e\u533a\u751f\u6001: \u5f00\u653e\u7684\u63d2\u4ef6\u7cfb\u7edf\u5438\u5f15\u5f00\u53d1\u8005\u53c2\u4e0e</li> </ol>"},{"location":"box_analysis/#_19","title":"\u5173\u952e\u8bbe\u8ba1\u6a21\u5f0f","text":"<ul> <li>\u5de5\u5382\u6a21\u5f0f: ApiConfig\u6839\u636e\u7c7b\u578b\u521b\u5efa\u4e0d\u540c\u7684Spider</li> <li>\u5355\u4f8b\u6a21\u5f0f: ApiConfig\u5168\u5c40\u552f\u4e00\u5b9e\u4f8b</li> <li>\u4ee3\u7406\u6a21\u5f0f: JsSpider\u4ee3\u7406JavaScript\u6267\u884c</li> <li>\u7b56\u7565\u6a21\u5f0f: \u4e0d\u540c\u7684\u63d2\u4ef6\u52a0\u8f7d\u5668\u5b9e\u73b0\u4e0d\u540c\u7b56\u7565</li> </ul>"},{"location":"box_analysis/#_20","title":"\u6280\u672f\u4eae\u70b9","text":"<ul> <li>QuickJS\u5f15\u64ce\u96c6\u6210\u63d0\u4f9b\u9ad8\u6027\u80fdJS\u6267\u884c</li> <li>DexClassLoader\u5b9e\u73b0\u771f\u6b63\u7684\u52a8\u6001\u63d2\u4ef6\u52a0\u8f7d</li> <li>\u5b8c\u5584\u7684\u7f13\u5b58\u673a\u5236\u63d0\u5347\u7528\u6237\u4f53\u9a8c</li> <li>\u6a21\u5757\u5316\u8bbe\u8ba1\u4fbf\u4e8e\u7ef4\u62a4\u548c\u6269\u5c55</li> </ul>"}]}